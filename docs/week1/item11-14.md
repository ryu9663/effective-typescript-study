# Item 11 잉여 속성 체크의 한계 인지하기 

## Excess Property Checks

- typescript는 필수조건만 충족한다면 **또 다른 어떤 속성**을 가지는 모든 객체는 해당 타입의 범위에 속함 (구조적 타이핑)

```ts
interface Options {
  title: string;
  darkMode?: boolean;
}

function createWindow(options: Options): void {
  const { title, darkMode = false } = options;
  console.log(`Creating window with title: ${title}`);
  if (darkMode) {
    console.log("Dart mode is enabled.");
  } else {
    console.log("Dart mode is disabled.");
  }
}

createWindow({ title: "My App" });
// 1. 문제 될 것 없는 코드지만 에러
// Object literal may only specify known properties, but 'darkmode' does not exist in type 'Options'. Did you mean to write 'darkMode'?ts(2561)
createWindow({ title: "My App", darkmode: true }); // 문제 될 것 없는 코드
const opts = { title: "My App", darkmode: true };
// 2. 에러도 발생 안함
createWindow(opts);
```

- 하지만 typescript에서는 **잉여 속성 검사** 또는 [초과 프로퍼티 검사(Excess Property Checks)](https://inpa.tistory.com/entry/TS-%F0%9F%93%98-%ED%83%80%EC%9E%85%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8A%B8-%EA%B0%9D%EC%B2%B4-%ED%83%80%EC%9E%85-%EC%B2%B4%ED%82%B9-%EC%9B%90%EB%A6%AC-%EC%9D%B4%ED%95%B4%ED%95%98%EA%B8%B0#%EC%B4%88%EA%B3%BC_%ED%94%84%EB%A1%9C%ED%8D%BC%ED%8B%B0_%EA%B2%80%EC%82%AC_excess_property_checks)를 통해서 초과한 프로퍼티에 대한 검사를 해주게 된다. 
  - 그리고 초과프로퍼티 중에서 다른 특정한 프로퍼티가 값이 들어오지 않은게 있다면 해당 값을 의미했던 것은 아닌지?에 대한 추론도 해준다.
  - 그러나 이러한 **초과 프로퍼티 검사**는 객체 리터럴(중괄호를 사용해 데이터를 구조화하여 즉시 객체를 만드는 방법)에만 동작한다. (2번 케이스의 경우 동작 안함)

### Exactly Type 

- 이를 막기 위한 꼼수로 Exactly custom type을 사용하는 방법이 있다.

```ts
interface Options {
  title: string;
  darkMode?: boolean;
}

type Exactly<T, U> = T & Record<Exclude<keyof U, keyof T>, never>;

function createWindowExact<T extends Exactly<Options, T>>(options: T): void {
  const { title, darkMode = false } = options;
  console.log(`Creating window with title: ${title}`);
  if (darkMode) {
    console.log("Dart mode is enabled.");
  } else {
    console.log("Dart mode is disabled.");
  }
}

// 1. 에러 발생: 'darkmode' 속성은 'never' 타입과 호환되지 않습니다.
createWindowExact({ title: "My App", darkmode: true });

const opts = { title: "My App", darkmode: true };
// 2. 이제 이 경우에도 에러가 발생합니다.
createWindowExact(opts);
```

> Exclude<keyof U, keyof T>: U 타입에는 있지만, T 타입에는 없는 속성 키를 찾아냄 (Exclude<A, B> : 타입 A에서 입 타입B에 속하는 멤버 제외) <br>
> Record<K, V>: 키 K와 값 V를 가지는 객체 타입을 생성하는 유틸리티 <br>
> never: TypeScript에서 절대 발생하지 않는 타입(공집합) <br>

> Exclude<keyof U, keyof T>의 결과는 Exclude<("title" | "darkmode"), ("title" | "darkMode")>가 됨 -> 결과적으로 남는 것은 "darkmode" <br>
> 잉여 속성들의 타입(never 타입)을 강제로 지정하는 객체 타입을 만듬 <br>
> Record<"darkmode", nver>의 결과는 darkmode: nver 타입이 됨 
> 두 타입을 교차하여 결합 (T & { darkmode: never }) -> 공집합에 값이 들어가면서 타입 에러 발생!


- 초과 프로퍼티 검사는 타입 단언문을 용용사요할 때에도 적용되지 않습니다.

```ts
interface Options {
  title: string;
  darkMode?: boolean;
}

// 에러 발생 안함
const o: Options = { darkmode: true, title: 'Ski Free'} as Options;
```

## 약한 타입

- 선택적 속성만 가지는 **약한(weak) 타입에도 비슷한 체크가 동작합니다.

```ts
interface Person {
  name?: string;
  age?: number;
}

// 에러 발생
const p1: Person = { Name: "Alice", Age: 30 };
const p2 = { Name: "Bob", Age: 25 };
// 객체 리터럴이 아닌데도 에러 발생
const p3: Person = p2;
console.log(p1.name, p3.name);
```

- typescript 팀은 약한 타입 변수에 객체를 할당할 때는, 할당되는 객체의 속성 중 최소 하나 이상이 약한 타입 인터페이스의 속성과 일치해야 한다고 설명합니다.

```ts
interface Person {
  name?: string;
  age?: number;
}

const o2 = { name: "Bob", Age: 25 };
// 에러 발생 안함
const p4: Person = o2;
```

> Excess Property Checking and Weak Types in TypeScript are discussed in the official TypeScript Handbook's "Object Types" section and the TypeScript 2.4 release notes. The weak type checking behavior is a standard part of TypeScript, also referenced in various blogs and Stack Overflow answers. You can find more information on the [Microsoft TypeScript documentation](https://www.google.com/search?q=chrome&rlz=1C5CHFA_enKR1180KR1180&sourceid=chrome&ie=UTF-8&udm=50&aep=48&cud=0&qsubts=1766412205579&mstk=AUtExfCPfskDNMs_52KZldAay6X0F7cu_jggbdoVbvu-1yn15VL87yePp5G2z06i0I7oBUsUQCy8rQgTFT5zPw_T6tZa3sbBrMNAC-zV8NptMnGLw4eM4kONQUzHZdrvMHfEtlLOx26F-FkIg5YhQuVUt6X-RVECl0ngfwtcE40zQsdOSiTODuflyTsP2P37VVts6cTF-gRJGb9cVd6JXjI4wMb7Fss10MPjg2S3WMvgTqjXeC7vS-GmjsRY6Q&csuir=1) and resources. 